import { Steps, Callout } from 'nextra-theme-docs';
import { PhotoProvider, PhotoView } from 'react-image-previewer';
import Subscribe from "components/subscribtion";

# ComfyUI 是什么？为何要学习它？

<br/>
<PhotoProvider>
  <PhotoView src="/introduction/why-comfyui.png">
    <img src="/introduction/why-comfyui.png" alt="" className='rounded-lg'/>
  </PhotoView>
</PhotoProvider>

在 AI 生图领域，有非常多的产品，比如 Midjourney，Recraft AI 等等。 甚至很多 AI Chat 工具也能生成图片。那 ComfyUI 与这些产品又有何不同？以及为何我会建议你学习 ComfyUI 呢？

## ComfyUI 是什么？

这个工具的开发者是这么定义 ComfyUI 的：

> The most powerful and modular diffusion model GUI and backend. This ui will let you design and execute advanced stable diffusion pipelines using a graph/nodes/flowchart based interface. 

翻译成中文就是：

> 最强大和模块化的扩散模型 GUI 和后端。这个 UI 将让你使用图形/节点/流程图界面设计并执行高级的 Stable Diffusion 管道。

听起来好像很复杂的样子。我们再调整精简一下:

<br/>
<PhotoProvider>
  <PhotoView src="/introduction/comfyui-def-cn.png">
    <img src="/introduction/comfyui-def-cn.png" alt="" className='rounded-lg'/>
  </PhotoView>
</PhotoProvider>

我们一个个来解释，首先，Diffusion 模型。你可能对它不太了解，没关系，你只需要知道它是一个可以生成图片的 AI 模型就可以了，你常常能听到的 SDXL，Flux 模型，都是 Diffusion 模型。

我们常说的计算机运行 AI 模型，其实更准确来说，计算机是在运行代码。

举个例子，当你在使用一款 AI 生图产品的时候，你会在「输入框」中输入指令，再点击「运行」按钮，然后计算机就会运行复杂的代码，最后得到最终的图片结果：

<br/>
<PhotoProvider>
  <PhotoView src="/introduction/003.png">
    <img src="/introduction/003.png" alt="" className='rounded-lg'/>
  </PhotoView>
</PhotoProvider>

一般情况下，这些代码都是由开发者编写，然后通过 UI 的方式提供给用户使用。但这就导致了一个问题：软件的拓展性，完全依赖于开发者。比如我不仅仅想要文生图功能，我还想要去背景功能，那该怎么办？一般都是等待开发者更新，或者找另一个符合需求的产品来使用。

为了解决这个「软件缺少拓展性」的问题，另一种叫 no code app builder（无代码应用构建器）的产品诞生了。像 Notion 或者 Airtable 就是此类产品。你不需要写代码，只需要通过拖拽的方式，就能搭建一个属于自己的应用（或者网站）。比如就有很多人用 Notion 搭建了自己的博客网站，你不需要依赖产品的开发者，自己就能实现特定的网页排版。你只需要将各种功能模块进行排列组合，就能实现你想要的样式或功能。这种产品就像是中国的[七巧板](https://en.wikipedia.org/wiki/Tangram)那样，你可以使用几个不同的形状的木块，通过排列组合的方式拼出不一样的形状（下图左边是七巧板原来的模样，右边是将七巧板排列组合成的其他形状）：

<br/>
<PhotoProvider>
  <PhotoView src="/introduction/004.png">
    <img src="/introduction/004.png" alt="" className='rounded-lg'/>
  </PhotoView>
</PhotoProvider>

但这种方式还是有局限性的，虽然产品给了你很多可排列组合的模块，但就像七巧板那样，因为它的模块是相对固定，且有限，所以你很可能无法拼出一些特殊的形状，比如圆形。

于是又有人思考，如果提供颗粒度更细，且数量更多的模块呢？是否能将关键的代码模块化，然后通过某种方式，将这些代码模块连接起来，从而能保证用户不需要懂代码的情况下，实现更复杂的功能？

就像是乐高积木那样，你可以通过不同的积木，拼出几乎无限的形状。而 ComfyUI 就是这样的产品。各位打开 ComfyUI 后，会看到类似这样的界面，你初看起来会很陌生，很难理解。但如果你从代码的角度理解，就能很好理解了。

<br/>
<PhotoProvider>
  <PhotoView src="/introduction/005.png">
    <img src="/introduction/005.png" alt="" className='rounded-lg'/>
  </PhotoView>
</PhotoProvider>

这些一个个的块块，其实背后都是一个个的代码模块，比如图中的 KSampler 节点，当你在这个节点里的 sampler_name 中选择 euler 后，这个节点就会调用相应的代码。

<br/>
<PhotoProvider>
  <PhotoView src="/introduction/node-to-code.png">
    <img src="/introduction/node-to-code.png" alt="" className='rounded-lg'/>
  </PhotoView>
</PhotoProvider>

这就是我前面提到的所谓的「图像化的方式」设计「代码」的含义。

但只有模块代码是不够的，因为一个模块代码，并不能单独运行。它需要与其他模块代码连接起来，从而实现模块与模块之间的数据传输，才能运行。最后就会形成所谓的「工作流」。

当各位点击下方的 Queue 按钮后，这些代码就会按顺序从左往右运行运行。就像前面提到的常见的 AI 生图产品那样。

只是说在 ComfyUI 里，点击按钮后，计算机运行的代码不是开发者写的代码了，而是你通过一个个的代码模块，通过连线的方式连接起来的代码。

## ComfyUI 与其他产品有何不同？

ComfyUI 的这种独特设计，给它带来了几个好处，从而让它与其他产品有了很大的不同。

### 好处一：无需懂代码，就能创造出独特的功能

正如我前面提到的那样，你可以通过调整 ComfyUI 里的各种块块（为了更准确地表示这些块块，后面我会将这些块块称为节点）的顺序，然后通过连线的方式「连」出代码。这就意味着你可以根据自己的需求实现不一样的功能。

举个例子，我想要将一张照片的背景去掉，然后换成渐变的背景，同时给人物增加白色描边：

<br/>
<PhotoProvider>
  <PhotoView src="/introduction/006.png">
    <img src="/introduction/006.png" alt="" className='rounded-lg'/>
  </PhotoView>
</PhotoProvider>

如果使用其他产品，那可能就没有这个功能（因为比较小众且特殊），或者说你需要多个功能合并使用才能实现，比如先去背景，再添加描边，再添加渐变背景。中间你可能需要用到多个产品。

但在 ComfyUI 里，你只需要将这些功能节点连接起来，就能实现这个功能。如下图所示，图中 ① 是一个加载图片的节点，② 是一个去背景的节点，③ 加载背景图，④ 是添加描边同时加渐变背景的节点。最后在 ⑤ 中得到最终的生成的图片。

<br/>
<PhotoProvider>
  <PhotoView src="/introduction/007.png">
    <img src="/introduction/007.png" alt="" className='rounded-lg'/>
  </PhotoView>
</PhotoProvider>

### 好处二：更快的开发速度，更丰富的生态

如果你细看上述的例子，你会发现，虽然你不需要写代码了，只要将各种功能节点连接起来，就能实现这个功能。但各个节点还是需要开发者开发吧？

是的，没错。就像你在拼乐高的时候那样，如果你想拼出某些特殊的形状，仍然需要乐高公司生产某些特殊的积木块才行。ComfyUI 的某些功能，仍然需要开发者开发某些特殊的节点才能实现。

但好在，ComfyUI 是款开源产品，所有开发者都能为其开发节点。

同时，也因为这种节点设计，开发者开发这些节点时候，不需要顾虑其他开源开发者，不需要与他人协作。所以开发这些节点的速度会非常快。

比如，开发者想要实现一个「去背景」的功能，开发者只需要开发一个「去背景」的节点就可以了，并且在开发的过程中，不需要顾虑其他开发者的实现。如果是在常见的应用中，如果某个开发者要开发一个「去背景」的功能，就需要考虑很多很多东西，比如这个按钮应该放在哪里，同时如果有另一个开发者也开发了类似的去背景功能，那么开发者还需要考虑如何将两个去背景的功能区分开来。

而 ComfyUI 的插件开发者就没有这种顾虑，用户可以自行选择安装一个或多个去背景节点，用哪个就把哪个接上。

这也就是为何 ComfyUI 的生态会如此丰富的原因。很多新的技术，可能论文才刚发布没几天，就有开发者开发出相应的节点，并将其加入到 ComfyUI 的生态中。据不完全统计，截止到 24 年 12 月，ComfyUI 的可用节点数量已经超过 1 万个。

### 好处三：更强的控制能力

前面提到，ComfyUI 里的一个个节点，其实都是一个个的代码模块。一般开发者会将这些代码模块所需要用到的参数，都暴露出来，从而让用户在节点上自由地调整这些参数。

这样就会带来第三种好处，对 AI 的生成结果有更强的控制能力。你可以根据自己的需求去调整各种参数，从而得出不一样的结果。如果是常见的应用，开发者为了让更多的人能学会使用该应用，一般都会将这些参数设置成一个固定值，用户无法调整。

而且除了参数外，也有不少开发者专门开发了一些与控制有关的节点，比如能让 AI 生成一模一样人脸的 PuLID，专门控制 AI 生成一模一样轮廓的 Canny ControlNet 等等。

<br/>
<PhotoProvider>
  <PhotoView src="/introduction/009.png">
    <img src="/introduction/009.png" alt="" className='rounded-lg'/>
  </PhotoView>
</PhotoProvider>

## ComfyUI 真的完美吗？

提了那么多 ComfyUI 的好处，那 ComfyUI 真的完美吗？

答案是：ComfyUI 并不是完美的。ComfyUI 的缺点主要有以下几点。

### 缺点一：需要一定的硬件支持

第二个问题就在于，ComfyUI 的运行需要一定的硬件支持。这个问题坦率说来不是它的问题，而是运行 AI 模型的问题。

我建议你在学习 ComfyUI 之前，先看看自己的电脑是否合适：

1. 如果你想要运行相对比较新的，且效果更好的模型，比如 Flux 或者 SD3.5 ，那么你需要最少 20G 显存，32G 内存。显卡品牌最好是 Nvida 的。
2. 如果你想要运行相对比较老的模型，比如 SD15，或者 SDXL 那么显卡的要求会低很多，基本上新款的笔记本电脑都能跑得动。但显卡品牌最好还是 Nvida 的。
3. 如果你用的是 Mac 电脑，坦率说来，我不太推荐用 Mac 运行 ComfyUI。虽然也能用，但你需要花不少时间去配置环境。部分新的模型或技术，有可能无法在 Mac 上运行。

当然如果你想要运行 ComfyUI，但你的电脑配置不够，那么你可以考虑使用像 Comflowy 这样的云端 ComfyUI 服务。

### 缺点二：安装困难

安装的部分，我会在后面详细讲解。这里我只提出问题，好让大家有个心理准备。

安装 ComfyUI 的时候，并不像其他软件那样，直接下载安装包，然后双击安装后就能运行。而是还需要安装相应的运行环境，比如 Python，CUDA 等等。

而且即使你安装好了 ComfyUI，当你在使用 ComfyUI 的过程中，你可能还会用到其他开发者开发的节点，要运行这些节点的，你可能还需要额外安装这些节点的运行环境。

这里我想展开解释下「何为运行环境」。

正如我前面提到，ComfyUI 上的节点，其实都是一个个的代码模块。开发者在写这些节点的时候，有可能已经有人实现过类似的功能了（比如某些 AI 技术论文公开的时候，还会公开相应的代码），所以开发者写这个节点的时候，为了节省时间，以及版权，会引用别人写的代码。

比如下图这个例子，这个节点是个去背景节点，里面有个选项是「rem_mode」，我选择了「RMBG」这个模型。你可以简单理解这个模型也是代码实现的，开发者写这个模型的代码的时候，也用到了别人写的代码，比如图中的 Coding #1 和 #2。为了减少代码数量，一般开发者不会直接复制这些要用到的代码，而是引用这些代码。那就意味着，要运行这个 RMBG 模型的代码，你的电脑上还需要有 Coding #1 和 #2 的代码。而这些代码就在这些所谓的运行环境代码里，这就是为何除了安装 ComfyUI 的主程序外，你还需要额外安装一堆东西的原因。

<br/>
<PhotoProvider>
  <PhotoView src="/introduction/008.png">
    <img src="/introduction/008.png" alt="" className='rounded-lg'/>
  </PhotoView>
</PhotoProvider>

另外，因为这些环境代码，可能还仅能在 Nvidia 的显卡上运行，就像很多游戏无法在 Mac 上运行一样。这就是为何我会在前面推荐你使用 Nvidia 显卡的原因。

### 缺点三：学习成本高

ComfyUI 的界面看起来很复杂，初学者可能需要花很长时间才能理解。正如我前面提到的那样，它就像是乐高积木，你不看说明书，可能很难拼出你想要的形状。

所以如果你想要使用 ComfyUI，你需要有一定的耐心，并且需要花时间去学习。

我也是从零开始学起，慢慢地我发现，虽然节点很多，但实际上各位常用的节点并不多，核心就那几个，搞懂了这几个核心，就能实现很多功能了。

本教程主要就是围绕这几个核心节点，来给大家讲解 ComfyUI 的用法。

我认为，ComfyUI 的入门并不难，难的是如何通过排列组合将这些节点相连，从而实现新的效果和创意。

需要的不仅仅是知道如何连线，以及使用各种节点，还需要有属于自己的品味和创意。



