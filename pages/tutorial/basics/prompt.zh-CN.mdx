import { Steps, Callout, Tabs } from 'nextra-theme-docs';
import { PhotoProvider, PhotoView } from 'react-image-previewer';
import Subscribe from "components/subscribtion";

# Prompt

<br/>

<PhotoProvider>
  <PhotoView src="/prompt/prompt.png">
    <img src="/prompt/prompt.png" alt="" className='rounded-lg'/>
  </PhotoView>
</PhotoProvider>

## 1. 写好 Prompt 并不简单

我们继续讲解上一章的思维导图。你除了可以调整模型外，还可以调整 Prompt。

<br/>

<PhotoProvider>
  <PhotoView src="/model-and-lora/001-cn.png">
    <img src="/model-and-lora/001-cn.png" alt="" className="rounded-lg" />
  </PhotoView>
</PhotoProvider>

但写好 Prompt 并不简单，我总结了以下几个原则：

- 原则一：prompt 不是越长越好

很多人刚学习 prompt 时，会觉得 prompt 越长越好，但实际上这是不对的。精准表达你的意图才是最重要的，而不是堆积非常多无用的词语。

另外，长度最好保持在 75 个 token（或约 60 个字）以内。

- 原则二：越重要的词放在靠前的位置
很多人在写 prompt 时，会较常忽略这一点。比如说，如果你想要生成一张猫的图片，那么你应该将「猫」这个词放在靠前的位置，而不是放在靠后的位置。

- 原则三：善用符号

* 使用逗号分隔：虽然 SDXL 在语意理解上已经有了很大的提升，但是在使用 prompt 时，还是建议使用逗号来分隔不同的意图。
* 使用 () 调整权重：你可以输入 `(keyword:weight)` 方式来控制关键词的权重，比如 `(hight building: 1.2 )` 就意味着 hight building 的权重变高，如果填写的权重数小于 1，则意味着这个词的权重会变低，生成的图与这个词更不相关。

- 原则四：尽量使用翻译，而不是让 AI 写 prompt

AI 写 prompt 的时候，常常会添加一些在你预期外的东西。当然有一些可能效果不错，但经过我的测试，往往是添加了我不太需要的东西。

所以，我建议你尽量使用翻译，而不是让 AI 写 prompt。在 ComfyUI 里，有不少翻译差异插件可以实现。部分翻译节点使用的是类似 Google 翻译这样的服务。你也可以使用 LLM 节点进行翻译。效果都还不错。

要想在 ComfyUI 里使用 LLM 节点，有两种方法，第一种是在本地直接运行一个 LLM 服务，然后使用 LLM 节点连接上这个 LLM 服务。但我不建议你使用这种方法，因为一是你需要安装额外的软件，二是运行 LLM 会额外占用你的显存，有可能导致你生图的时候出现显存不足的情况。第二种方法是使用 LLM API 节点，简单理解就是这个节点会调用外部的 LLM 服务，比如 OpenAI 的 API。这样好处是不需要你额外安装软件，二是不会占用你的显存。但你有可能需要支付一些费用。

但现在也有一些免费的 LLM API 节点，比如我们的 Comflowy LLM 节点 🙂，你可以通过 ComfyUI Manger 安装，或者直接去到我们的插件 [Github 页面](https://github.com/6174/comflowy-nodes) 下载使用。

安装好插件后，只需要添加 Comflowy LLM 节点（图中①），然后在 system prompt 里输入「将我输入的内容翻译成英文」，然后在 llm model 里选择你想要使用的模型。然后将其接到 CLIP Text Encode 节点。如果你想要显示这个节点的输出效果，可以在这个节点后，接入一个 Show Any 节点（图中②）。输入完 Prompt 后，点击运行，你就能在 Show any 节点看到翻译后的 Prompt 了。

<br/>

<PhotoProvider>
  <PhotoView src="/prompt/001.png">
    <img src="/prompt/001.png" alt="" className="rounded-lg" />
  </PhotoView>
</PhotoProvider>

<Callout type="warning" emoji="⚠️">
  你可能不知道如何将 LLM 节点连到 CLIP Text Encode 节点上，这里我简单介绍一下。右键点击 CLIP Text Encode 节点，选择「Convert Widget to Input」，然后选择「Convert text to input」，这样 CLIP Text Encode 节点的输入框就会消失，然后多一个 text 端点。
  <br/>
  <PhotoProvider className='mt-10'>
    <PhotoView src="/prompt/002.png">
      <img src="/prompt/002.png" alt="" className="rounded-lg" />
    </PhotoView>
  </PhotoProvider>
</Callout>

## 2. Prompt 基本模板

了解完基本原则后，我们介绍下写 prompt 的模板，一般 prompt 会包含以下内容：
1. **Subject**：因为主体是最重要的，所以主体一般会放在首位。
2. **Environment**：环境包含：
    * 主体周围的环境，比如说「在一片森林里」、「在一片草地上」等等。
    * 灯光，比如「闪电」、「月光」等等。
    * 天气，比如「下雨」、「下雪」等等。
3. **Medium**：媒介可以是图片的拍摄媒介，如「相机」，亦或者承载的媒介，比如「油画」。
4. **Style**：可以用 4W 记忆：
    * When：什么年代的风格？
    * Who：你想要谁的风格？（人或组织）
    * What：什么艺术类型的风格？或者艺术运动的风格？
    * Where：什么国家的风格？

## 3. 学习 prompt 的方法

其实了解完 prompt 的基本原则和模板后，你就已经可以写 prompt 并生成图片了。但是，我认为绝大数人（包括我）其实很难一次就生成你脑海中满意的图片。原因是：

* 绝大多数人缺乏对美的认知：这是一个很大的问题，因为你不知道你想要的图片是什么样的，所以你也不知道该怎么写 prompt。
* 绝大多数人缺乏美术相关知识：即使你知道什么是美，但是你不知道该怎么表达出来，比如如果你根本不知道世界上有一名画家叫「梵高」，那你不可能会在 prompt 里写出「梵高风格」这样的词语。

那有没有解决方案呢？

**我觉得最佳的方法是「先模仿后超越」。** 先去看别人怎么写，然后根据自己的需求进行修改，并且通过控制变量的方式去多尝试，比如一次只改一个词，这样你就能知道每个词对生成图片的影响。

我推荐几个不错的学习网站：

* [Civitai](https://civitai.com/images)：大名鼎鼎的 C 站，这个应该是目前全球最大的 AI 图片社区，我在那学到了非常多东西。
* [PromptHero](https://prompthero.com/)：这也是一个很不错的 AI 图片社区，但感觉比 Civitai 小一些。
* [Learning Prompt](https://learningprompt.wiki/)：虽然我当年写的教程是针对 Midjourney 的，但里面场景案例对于学习 Stable Diffusion 依然有参考意义。

## 4. 不会写也可以靠插件帮忙

最后，除了自己写 Prompt 外，你也可以使用一些插件帮忙。这些插件本质上来说，其实就是一个表单选择器，可以通过选择方式，生成你想要的 Prompt。

我这里推荐

### 4.1 Bilbox ComfyUI

第一个插件是 [Bilbox ComfyUI](https://github.com/syllebra/bilbox-comfyui)。这个插件可以帮你更好地组织你的 prompt。

你可以通过 ComfyUI Manager 安装此插件，亦或者通过 Git Clone 的方式安装。详细的安装方式，可以参考[安装 ComfyUI 插件](https://comflowy.com/advanced/how-to-install-comfyui-extension)一文。

<Callout type="warning" emoji="⚠️">
  注意，这个插件比较适合写相片类图片的 prompt。
</Callout>

使用方法很简单，首先需要在 `CLIP Text Encode` 节点（图中①）前插入一个 `BilboX` 节点（图中②），并将其与 `CLIP Text Encode` 节点的 `text` 端点相连。然后根据插件的提示，填写或选择你需要的 Prompt 即可。比如下图，我选择了街拍照，还添加了一些光线的选择。最后生成的图非常完美：

<br/>

<PhotoProvider>
  <PhotoView src="/prompt/flux-bilbox.png">
    <img src="/prompt/flux-bilbox.png" alt="" className="rounded-lg" />
  </PhotoView>
</PhotoProvider>



另外，可能有人不知道如何将 `CLIP Text Encode` 节点的 `text` 端点显示出来。其实很简单，只需要在 `CLIP Text Encode` 节点（图中①）上右键，然后在菜单中选择 `Convert Widget to Input` （图中②），然后选择 `Convert text to input`（图中③）即可。

<PhotoProvider>
  <PhotoView src="/prompt/003.png">
    <img src="/prompt/003.png" alt="" className="rounded-lg" />
  </PhotoView>
</PhotoProvider>


### 4.2 Flux Prompt Generator

第一个插件比较适合生成照片类的 Prompt，但第二个插件则可以帮你生成更完备的 Flux 的 prompt，它就是 [Flux Prompt Generator](https://github.com/fairy-root/Flux-Prompt-Generator)。

安装完插件后，将其添加到 workflow 中，你可以看到它的选项比第一个插件更多：

<br/>

<PhotoProvider>
  <PhotoView src="/prompt/flux-prompt-generator.png">
    <img src="/prompt/flux-prompt-generator.png" alt="" className="rounded-lg" />
  </PhotoView>
</PhotoProvider>


### 4.3 ComfyUI Portrait Master

最后一个插件是 [ComfyUI Portrait Master](https://github.com/florestefano1975/comfyui-portrait-master)。这个插件在脸部细节的设置会比较多，可以帮你写出更适合 Portrait 场景的 Prompt。

<br/>

<PhotoProvider>
  <PhotoView src="/prompt/flux-portrait-master.png">
    <img src="/prompt/flux-portrait-master.png" alt="" className="rounded-lg" />
  </PhotoView>
</PhotoProvider>


<Subscribe />