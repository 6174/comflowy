import { Steps, Callout, Tabs } from 'nextra-theme-docs';
import { PhotoProvider, PhotoView } from 'react-image-previewer';
import Subscribe from "components/subscribtion";

# 下载 & 导入模型

安装完 ComfyUI 后，你需要下载对应的模型，并将对应的模型导入到对应的文件夹内。在讲解如何下载模型之前，我们先来简单了解一下 Stable Diffusion 的不同版本之间的差别，你可以根据你自己的需求下载一个合适的版本。

另外，你也可以参考这两篇博客：
1. [如何选择合适的模型？](https://www.comflowy.com/zh-CN/blog/how-to-choose-a-model)
2. [10 个值得下载的模型](https://www.comflowy.com/zh-CN/blog/ten-models-worth-downloading)

除此之外，为了方便各位更好地找到适合的模型，我们还做了一个模型推荐页面，你可以根据自己需求找到合适的模型：[模型推荐](https://www.comflowy.com/zh-CN/model)。

## 不同 Stable Diffusion 的差别

<Callout type="info">
  在后续的教程中，我会介绍更多模型相关的介绍。
</Callout>

### Stable Diffusion v1.5
- 这是 Stable Diffusion 的的早期版本，目前市场上的很多 Lora 模型以及 ContrlNet 模型都是基于它来构建的，所以在开始使用 ComfyUI 的时候为了少踩坑，建议围绕 1.5 版本进行学习。
- 模型官方介绍：[Stable Diffusion v1.x press release](https://stability.ai/blog/stable-diffusion-public-release)
- 下载链接：[v1.5 pruned](https://huggingface.co/runwayml/stable-diffusion-v1-5/resolve/main/v1-5-pruned.safetensors?download=true)

### Stable Diffusion v2.0
- 这是 Stable Diffusion 的一个重大更新，相比于 v1.5 版本，它在图像生成质量和速度上都有所提升。
- 2.0 版本采用了新的文本编码器 OpenCLIP，可以更好地理解文本提示，从而生成更高质量的图像。此外，2.0 版本还支持更高的图像分辨率，可以生成默认分辨率为 512x512 像素和 768x768 像素的图像。
- 模型官方介绍：[Stable Diffusion v2 press release](https://stability.ai/blog/stable-diffusion-v2-release)

### Stable Diffusion XL
- 这是 Stable Diffusion 的最新版本，它在 2.0 版本的基础上进行了进一步的优化和改进。
- XL 版本的主要特点是其更大的模型大小，从 0.98B 扩大到 6.6B 参数，这使得它能够生成更高质量的图像。
- XL 版本还引入了新的功能，如更有艺术感的图像，更真实的图像，以及更清晰可读的字体等。
- 模型官方介绍：[Stable Diffusion xl 1.0 press release](https://stability.ai/news/stable-diffusion-sdxl-1-announcement)
- 下载链接：
  - [Base](https://huggingface.co/stabilityai/stable-diffusion-xl-base-1.0/resolve/main/sd_xl_base_1.0_0.9vae.safetensors?download=true)
  - [Refiner](https://huggingface.co/stabilityai/stable-diffusion-xl-refiner-1.0/resolve/main/sd_xl_refiner_1.0.safetensors?download=true)

## 模型下载 

我常用的下载渠道有两个，一个是 HuggingFace，最后一个是 CivitAI 站点。

### HuggingFace

你可以将 HuggingFace 理解为 AI 届的 Github。上面会有不少人或组织会将他们的模型分享到上面。你可以通过 HuggingFace 的搜索功能来搜索你想要的模型。

比如我们搜索 Stable Diffusion v1.5，你会看到这样的页面，然后我们点击页面里的 Files and versions 按钮（图中 1），接着你会看到很多文件，此时你需要选择你需要下载的模型文件，然后点击下载按钮（图中 2）：
<br/>
<PhotoProvider>
  <PhotoView src="/install-comfyui-and-model/010.png">
      <img src="/install-comfyui-and-model/010.png" alt="" className='rounded-lg'/>
  </PhotoView>
</PhotoProvider>

一般你会看到两种后缀的模型：

- **safetensors**：这种模型一般用的是 numpy 格式保存，这就意味着它只保存了张量数据，没有任何代码，加载这类文件会更安全和更快。
- **ckpt**：这种文件是序列化过的，这意味着它们可能会包含一些恶意代码，加载这类模型就可能会带来安全风险。

所以在上述的案例中，我会推荐你下载 safetensors 格式的模型。

另外，我建议你在搜索模型的时候，需要看看是不是该模型的官方发的，一般我会看模型的下载数，一般下载数越多的模型，越有可能是官方发的。

### CivitAI

与 HuggingFace 不同，CivitAI 站点更偏向于 UGC 一些，所以你会看到更多个人训练的模型，但是这并不意味着它们的质量会差，相反，你会发现有些模型的质量非常好。

而且 CivitAI 比 HuggingFace 多了很多好用的功能，比如你可以通过筛选等方式，看到各种各样优秀的模型：
<br/>
<PhotoProvider>
  <PhotoView src="/install-comfyui-and-model/011.png">
      <img src="/install-comfyui-and-model/011.png" alt="" className='rounded-lg'/>
  </PhotoView>
</PhotoProvider>

同样的，你也可以通过 CivitAI 的搜索功能来搜索你想要的模型，并下载该模型，以 DreamShaper 为例，你只要点击下载按钮（图中 1）即可下载模型：
<br/>
<PhotoProvider>
  <PhotoView src="/install-comfyui-and-model/012.png">
      <img src="/install-comfyui-and-model/012.png" alt="" className='rounded-lg'/>
  </PhotoView>
</PhotoProvider>

<Callout type="warning" emoji="⚠️">
  在后续的教程中，我会使用到各种模型，你都可以根据自己的需求在以上两个渠道下载不同的模型。但现在我建议你先在 HuggingFace 上下载 Stable Diffusion v1.5 和 Stable Diffusion XL 模型，前者有很多配套的模型，而后者的出图效果相对比较好，不少最新的模型也都有基于它去优化。
</Callout>

## 模型导入

<Tabs items={['ComflowySpace 导入', 'ComfyUI 导入']}>
  <Tabs.Tab>
    如果你使用的是 ComflowySpace，那么你可以直接在 ComflowySpace 上导入模型。具体的操作步骤如下：
    1. 切换到 Models 的界面，然后点击右上角的 Model Folder 的按钮（图中①），
    2. 打开该文件夹后，点击进入里面的 checkpoint 文件夹，将你下载好的模型放入其中。
    3. 最后再点击一下 Refresh 按钮（图中②）。
    <br/>
    <PhotoProvider>
      <PhotoView src="/install-comfyui-and-model/023.png">
          <img src="/install-comfyui-and-model/023.png" alt="" className='rounded-lg'/>
      </PhotoView>
    </PhotoProvider>
  </Tabs.Tab>
  <Tabs.Tab>
    在下载完模型后，我们需要将模型导入到 ComfyUI 的 models 目录下，这样 ComfyUI 才能够加载到对应的模型。

    <Callout type="info">
    如果你曾经安装过 SD WebUI，并且下载过比较多的模型，那此时你不需要手动再导入模型，只需要更改一下配置文件即可。
    </Callout>

    <Tabs items={['未安装过 SD WebUI', '已安装 SD WebUI']}>
      <Tabs.Tab>
        模型下载好后，我们要将对应的模型放到 ComfyUI 的 models 目录下。
        <Steps>
          ### 打开 ComfyUI 项目文件夹
          你可以使用上一章提到的 Github Desktop，打开 ComfyUI 项目的文件夹。在 Github Desktop 上点击「Show in Finder」按钮，如果是 Win 则是「Show in Explorer」按钮。即可打开该项目的文件夹。然后你需要点击进入到 models 目录下：
          <PhotoProvider>
            <PhotoView src="/install-comfyui-and-model/013.png">
                <img src="/install-comfyui-and-model/013.png" alt="" width="80%" style={{ display: "block", margin: "0 auto" }}/>
            </PhotoView>
          </PhotoProvider>

          ### 将模型添加到对应的文件夹
          进入到 Model 文件夹后，你会看到很多个文件夹，这些文件夹分别对应着不同的模型，你需要将你下载的模型放到对应的文件夹下。比如我们刚刚下载的是 Stable Diffusion v1.5 模型，属于 checkpoints 就需要将该模型放到 checkpoints 文件夹下。后续我们会介绍不同的类型的模型，你需要将其放到对应的文件夹里，比如后面会介绍的 LoRA 模型就要放到 loras 文件夹下。
          <PhotoProvider>
            <PhotoView src="/install-comfyui-and-model/014.png">
                <img src="/install-comfyui-and-model/014.png" alt="" width="80%" style={{ display: "block", margin: "0 auto" }}/>
            </PhotoView>
          </PhotoProvider>
        </Steps>
      </Tabs.Tab>
      <Tabs.Tab>
        <Steps>
          ### 打开 ComfyUI 项目文件夹
          打开 ComfyUI 项目文件夹，并在 ComfyUI 文件夹里找到一个叫 `extra_model_paths.yaml.example` 的文件。
          
          ### 修改文件名
          接着，将这个文件名改为 `extra_model_paths.yaml`。
          
          ### 右键使用 VSCode 打开该文件，并修改配置
          打开文件后，找到这一行代码：
          ``` yaml
          base_path: path/to/stable-diffusion-webui/ 
          ```
          将冒号后面的路径改为你的 SD webui 的路径。比如你是 Mac 用户，那就可能是：
          ```shell
          Users/jimmy/stable-diffusion-webui/
          ```
          如果你是 Win 用户，那就可能是 
          ```shell
          C:/Users/jimmy/stable-diffusion-webui/
          ```
        </Steps>
      </Tabs.Tab>
    </Tabs>
  </Tabs.Tab>
</Tabs>

🎉 恭喜你，又完成了一个重要的步骤，接下来我们就可以正式进入 ComfyUI 基础篇的学习了。

<Subscribe />